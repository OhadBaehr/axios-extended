{"version":3,"file":"AxiosExtended.cjs","sources":["../src/AxiosExtended.ts"],"sourcesContent":["\r\n\r\n\r\nimport axios, { AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios'\r\n\r\nimport type { ExtractPropertyFromArrayIfExist, InferPropertyType, Override, SerializableObject, SingleElement, StrictPartial, WithRequired } from './types'\r\nimport type { PickKeys } from 'ts-essentials';\r\n\r\n\r\nexport interface MethodsMap {\r\n    POST: { body: true },\r\n    PUT: { body: true },\r\n    PATCH: { body: true },\r\n    DELETE: { body: false },\r\n    GET: { body: false },\r\n    OPTIONS: { body: false }\r\n}\r\n\r\nexport interface WithoutBodyApiEndpoint {\r\n    params: SerializableObject;\r\n    response: SerializableObject;\r\n}\r\n\r\nexport interface WithBodyAPIEndpoint extends WithoutBodyApiEndpoint {\r\n    body: SerializableObject;\r\n}\r\n\r\n\r\n\r\nexport type Methods = PickKeys<MethodsMap, unknown>\r\n\r\nexport type MethodsWithBody = PickKeys<MethodsMap, { body: true }>\r\nexport type MethodsWithoutBody = PickKeys<MethodsMap, { body: false }>\r\n\r\n\r\nexport type APIEndpointType = { URL: string } & { [key in MethodsWithBody]: WithBodyAPIEndpoint } & { [key in MethodsWithoutBody]: WithoutBodyApiEndpoint }\r\n\r\n\r\nexport type ApiEndpointsMapper<T extends WithRequired<StrictPartial<SingleElement<T>, APIEndpointType>, \"URL\">[], method extends Methods | \"URL\" = \"URL\"> = {\r\n    [K in ExtractPropertyFromArrayIfExist<T, \"URL\", method>]: Extract<T[number], { URL: K }>\r\n};\r\n\r\nexport type ReqType<T extends StrictPartial<T, APIEndpointType>, RequestType, M extends keyof T> = Override<RequestType, {\r\n    method: M;\r\n    body: M extends MethodsWithBody ? InferPropertyType<T[M], \"body\"> : never\r\n    query: M extends Methods ? InferPropertyType<T[M], \"params\"> : never\r\n}>\r\n\r\nexport function createAPI<ReqTypeBase, ResType, NextType=unknown>() {\r\n    type ReqTypeGenerate<T extends StrictPartial<T, APIEndpointType>, K extends string> = ReqType<T, ReqTypeBase, K extends keyof T ? K : never>\r\n    return function <T extends StrictPartial<T, APIEndpointType>>(callback: (\r\n        req: (\r\n            ReqTypeGenerate<T, \"POST\"> |\r\n            ReqTypeGenerate<T, \"PUT\"> |\r\n            ReqTypeGenerate<T, \"PATCH\"> |\r\n            ReqTypeGenerate<T, \"DELETE\"> |\r\n            ReqTypeGenerate<T, \"GET\"> |\r\n            ReqTypeGenerate<T, \"OPTIONS\">\r\n        ),\r\n        res: ResType,\r\n        next?: NextType\r\n    ) => void) {\r\n        return callback\r\n    }\r\n}\r\n\r\nexport function AxiosExtended<API extends WithRequired<StrictPartial<SingleElement<API>, APIEndpointType>, \"URL\">[] = []>(config?: AxiosRequestConfig) {\r\n    const axiosInstance = axios.create(config)\r\n    type MappedAPI = ApiEndpointsMapper<API>\r\n\r\n    type HTTPMethodWithBody<T extends string> = <Url extends ExtractPropertyFromArrayIfExist<API, \"URL\", T>, Request extends InferPropertyType<MappedAPI[Url], T>>(url: Url, body: InferPropertyType<Request, \"body\">, config?: Override<AxiosRequestConfig, {\r\n        params: InferPropertyType<Request, \"params\">\r\n    }>) => Promise<AxiosResponse<InferPropertyType<Request, \"response\", unknown>>>\r\n\r\n    type HTTPMethodWithoutBody<T extends string> = <Url extends ExtractPropertyFromArrayIfExist<API, \"URL\", T>, Request extends InferPropertyType<MappedAPI[Url], T>>(url: Url, config?: Override<AxiosRequestConfig, {\r\n        params: InferPropertyType<Request, \"params\">\r\n    }>) => Promise<AxiosResponse<InferPropertyType<Request, \"response\", unknown>>>\r\n\r\n    return axiosInstance as (SingleElement<API> extends APIEndpointType ? AxiosInstance : Override<AxiosInstance, {\r\n        post: HTTPMethodWithBody<\"POST\">\r\n        put: HTTPMethodWithBody<\"PUT\">\r\n        patch: HTTPMethodWithBody<\"PATCH\">\r\n\r\n        get: HTTPMethodWithoutBody<\"GET\">\r\n        options: HTTPMethodWithoutBody<\"OPTIONS\">\r\n        delete: HTTPMethodWithoutBody<\"DELETE\">\r\n    }>)\r\n}\r\n\r\n\r\nexport default AxiosExtended\r\n"],"names":["AxiosExtended","config","axios","create","callback"],"mappings":"wHAkEgBA,EAA0GC,GAYtH,OAXsBC,EAAAA,QAAMC,OAAOF,EAoBvC,sDArCI,gBAA8DG,GAY1D,OAAOA,CACX,CACJ"}